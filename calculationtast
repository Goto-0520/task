#!/bin/bash
# SPDX-FileCopyrightText: Hiroaki Goto
# SPDX-Lisence-Indentifer: BSD-3-Clause

# 色の定義
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

test_reset_calculation() {
    local result=$(echo -e "r\nq" | python3 calculation | grep "結果をリセットしました" | wc -l)
    [[ "$result" -gt 0 ]] && return 0 || return 1
}

test_invalid_operator() {
    local result=$(echo -e "x\nq" | python3 calculation | grep "無効な入力です" | wc -l)
    [[ "$result" -gt 0 ]] && return 0 || return 1
}

# テスト実行関数
run_tests() {
    local TOTAL=0
    local PASSED=0
    local FAILED=0

    # テスト関数の配列
    TESTS=(
        test_reset_calculation
        test_invalid_operator
    )

    echo -e "${YELLOW}計算機プログラムテストを開始します...${NC}"

    # 各テストの実行
    for test in "${TESTS[@]}"; do
        ((TOTAL++))
        echo -n "Running $test: "
        if $test; then
            echo -e "${GREEN}PASSED${NC}"
            ((PASSED++))
        else
            echo -e "${RED}FAILED${NC}"
            ((FAILED++))
        fi
    done

    # テスト結果の表示
    echo "-------------------"
    echo -e "総テスト数: ${YELLOW}$TOTAL${NC}"
    echo -e "成功したテスト: ${GREEN}$PASSED${NC}"
    echo -e "失敗したテスト: ${RED}$FAILED${NC}"

    # 全テストが成功したかをチェック
    if [ $FAILED -eq 0 ]; then
        echo -e "${GREEN}全テストに成功しました${NC}"
        exit 0
    else
        echo -e "${RED}一部のテストに失敗しました。${NC}"
        exit 1
    fi
}

# メイン実行
run_tests
